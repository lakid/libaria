<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Aria: gripperExample.cpp</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Aria
   &#160;<span id="projectnumber">2.9.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('gripperExample_8cpp-example.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">gripperExample.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example program demonstrating use of the Pioneer gripper. Shows how to control the Pioneer 2DOF gripper accessory. In addition to the arrow keys to teleoperate the robot, Use the following keyboard keys to control it: u Lift the gripper up d Lift the gripper down o Open the gripper c Close the gripper s Stop gripper movement.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="classArModeGripper.html" title="Mode for controlling the gripper.">ArModeGripper</a> (the gripper control mode used in the "demo" program)</dd></dl>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &quot;Aria.h&quot;</span>

<span class="comment">// Adds robot callback to print gripper status.</span>
<span class="keyword">class </span>PrintGripStatus
{
  <a name="_a0"></a><a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a>* myGripper;
  <a name="_a1"></a><a class="code" href="classArFunctorC.html">ArFunctorC&lt;PrintGripStatus&gt;</a> myPrintCB;
<span class="keyword">public</span>:
  PrintGripStatus(<a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a>* gripper) : 
    myGripper(gripper),
    myPrintCB(<span class="keyword">this</span>, &amp;PrintGripStatus::printStatus)
  {
  }

  <span class="keywordtype">void</span> addRobotTask(<a name="_a2"></a><a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a>* robot)
  {
    robot-&gt;<a name="a3"></a><a class="code" href="classArRobot.html#a50070f4e19b91aaac20772d15d9ad805" title="Adds a user task to the list of synchronous taskes.">addUserTask</a>(<span class="stringliteral">&quot;PrintGripStatus&quot;</span>, 10, &amp;myPrintCB);
  }

  <span class="keywordtype">void</span> printStatus()
  {
    myGripper-&gt;logState();
  }
};

<span class="comment">// Adds key handler callbacks for controlling the gripper</span>
<span class="keyword">class </span>GripperControlHandler
{
  <a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a>* myGripper;
  <a name="_a4"></a><a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myUpCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myDownCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myOpenCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myCloseCB;
  <a class="code" href="classArFunctorC.html">ArFunctorC&lt;GripperControlHandler&gt;</a> myStopCB;
<span class="keyword">public</span>:
  GripperControlHandler(<a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a>* gripper) : 
    myGripper(gripper),
    myUpCB(this, &amp;GripperControlHandler::liftUp),
    myDownCB(this, &amp;GripperControlHandler::liftDown),
    myOpenCB(this, &amp;GripperControlHandler::open),
    myCloseCB(this, &amp;GripperControlHandler::close),
    myStopCB(this, &amp;GripperControlHandler::stop)
  {
  }

  <span class="keywordtype">void</span> addKeyHandlers(<a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> *robot)
  {
    <a name="_a5"></a><a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a> *keyHandler = <a name="a6"></a><a class="code" href="classAria.html#a5b8042b38b19d6a5d3cfbed4df483e67" title="Gets a pointer to the global key handler, if one has been set with setKeyHandler()">Aria::getKeyHandler</a>();
    <span class="keywordflow">if</span>(keyHandler == NULL)
    {
      keyHandler = <span class="keyword">new</span> <a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a>();
      <a name="a7"></a><a class="code" href="classAria.html#a9e5496a4ec2c379c8e18706922b57cc1" title="Sets the key handler, so that other classes can find it using getKeyHandler()">Aria::setKeyHandler</a>(keyHandler);
      robot-&gt;<a name="a8"></a><a class="code" href="classArRobot.html#ab4ea516667d2358f35b435d97b616ab1" title="Attachs a key handler.">attachKeyHandler</a>(keyHandler);
    }
    keyHandler-&gt;<a name="a9"></a><a class="code" href="classArKeyHandler.html#ad5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a10"></a><a class="code" href="classArKeyHandler.html#a665246cd772590dd02ea299dd047899ca0a916e5fd9baf9ed01442a1e0d996f9c" title="Page Up (not supported on Windows yet)">ArKeyHandler::PAGEUP</a>, &amp;myUpCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#ad5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">&#39;u&#39;</span>, &amp;myUpCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#ad5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a11"></a><a class="code" href="classArKeyHandler.html#a665246cd772590dd02ea299dd047899caabbedf3b93d1e2a1f09298be2dbeca30" title="Page Down (not supported on Windows yet)">ArKeyHandler::PAGEDOWN</a>, &amp;myDownCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#ad5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">&#39;d&#39;</span>, &amp;myDownCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#ad5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">&#39;o&#39;</span>, &amp;myOpenCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#ad5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">&#39;c&#39;</span>, &amp;myCloseCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#ad5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">&#39;s&#39;</span>, &amp;myStopCB);
  }

  <span class="keywordtype">void</span> liftUp()
  {
    <a name="a12"></a><a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a13"></a><a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;Moving gripper lift up...&quot;</span>);
    myGripper-&gt;liftUp();
  }

  <span class="keywordtype">void</span> liftDown()
  {
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;Moving gripper lift down...&quot;</span>);
    myGripper-&gt;liftDown();
  }

  <span class="keywordtype">void</span> stop()
  {
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;Stopping gripper...&quot;</span>);
    myGripper-&gt;gripperHalt(); <span class="comment">// stops both lift an grip</span>
    <span class="comment">//myGripper-&gt;liftStop(); // stops just the lift</span>
    <span class="comment">//myGripper-&gt;gripStop(); // stops just the gripper</span>
  }

  <span class="keywordtype">void</span> close()
  {
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;Closing gripper...&quot;</span>);
    myGripper-&gt;gripClose();
  }

  <span class="keywordtype">void</span> open()
  {
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;Opening gripper...&quot;</span>);
    myGripper-&gt;gripOpen();
  }

};

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) 
{
  <a name="a14"></a><a class="code" href="classAria.html#ad99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including adding OS sign...">Aria::init</a>();
  <a name="_a15"></a><a class="code" href="classArArgumentParser.html" title="Parse and store program command-line arguments for use by other ARIA classes.">ArArgumentParser</a> parser(&amp;argc, argv);
  parser.loadDefaultArguments();
  <a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> robot;
  <a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a> gripper(&amp;robot);

  <span class="comment">// Connect to the robot, get some initial data from it such as type and name,</span>
  <span class="comment">// and then load parameter files for this robot.</span>
  <a name="_a16"></a><a class="code" href="classArRobotConnector.html" title="Connect to robot or simulator based on program command line parameters.">ArRobotConnector</a> robotConnector(&amp;parser, &amp;robot);
  <span class="keywordflow">if</span>(!robotConnector.connectRobot())
  {
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a17"></a><a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">&quot;gripperExample: Could not connect to the robot.&quot;</span>);
    <span class="keywordflow">if</span>(parser.checkHelpAndWarnUnparsed())
    {
        <span class="comment">// -help not given</span>
        <a name="a18"></a><a class="code" href="classAria.html#a10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())">Aria::logOptions</a>();
        <a name="a19"></a><a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
    }
  }

  <span class="keywordflow">if</span> (!<a name="a20"></a><a class="code" href="classAria.html#a1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())">Aria::parseArgs</a>() || !parser.checkHelpAndWarnUnparsed())
  {
    <a class="code" href="classAria.html#a10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())">Aria::logOptions</a>();
    <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
  }

  <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;gripperExample: Connected to robot.&quot;</span>);


  <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;gripperExample: GripperType=%d&quot;</span>, gripper.getType());
  gripper.logState();
  <span class="keywordflow">if</span>(gripper.getType() == <a name="a21"></a><a class="code" href="classArGripper.html#a565fcee58e47e92596e472c34f359368ae1f5be72993ec3d941480086a6948e57" title="There isn&#39;t a gripper.">ArGripper::NOGRIPPER</a>)
  {
    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">&quot;gripperExample: Error: Robot does not have a gripper. Exiting.&quot;</span>);
    <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(-1);
    <span class="keywordflow">return</span> -1;
  }

  <span class="comment">// Teleoperation actions with obstacle-collision avoidance</span>
  <a name="_a22"></a><a class="code" href="classArActionLimiterTableSensor.html" title="Action to limit speed (and stop) based on whether the &quot;table&quot;-sensors see anything.">ArActionLimiterTableSensor</a> tableLimit;
  robot.<a name="a23"></a><a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;tableLimit, 110);
  <a name="_a24"></a><a class="code" href="classArActionLimiterForwards.html" title="Action to limit the forwards motion of the robot based on range sensor readings.">ArActionLimiterForwards</a> limitNearAction(<span class="stringliteral">&quot;near&quot;</span>, 300, 600, 250);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limitNearAction, 100);
  <a class="code" href="classArActionLimiterForwards.html" title="Action to limit the forwards motion of the robot based on range sensor readings.">ArActionLimiterForwards</a> limitFarAction(<span class="stringliteral">&quot;far&quot;</span>, 300, 1100, 400);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limitFarAction, 90);
  <a name="_a25"></a><a class="code" href="classArActionLimiterBackwards.html" title="Action to limit the backwards motion of the robot based on range sensor readings.">ArActionLimiterBackwards</a> limitBackAction;
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limitBackAction, 50);
  <a name="_a26"></a><a class="code" href="classArActionJoydrive.html" title="This action will use the joystick for input to drive the robot.">ArActionJoydrive</a> joydriveAction(<span class="stringliteral">&quot;joydrive&quot;</span>, 400, 15);
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;joydriveAction, 40);
  joydriveAction.setStopIfNoButtonPressed(<span class="keyword">false</span>);
  <a name="_a27"></a><a class="code" href="classArActionKeydrive.html" title="This action will use the keyboard arrow keys for input to drive the robot.">ArActionKeydrive</a> keydriveAction;
  robot.<a class="code" href="classArRobot.html#a9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;keydriveAction, 30);
  

  <span class="comment">// Handlers to control the gripper and print out info (classes defined above)</span>
  PrintGripStatus printStatus(&amp;gripper);
  GripperControlHandler gripControl(&amp;gripper);
  printStatus.addRobotTask(&amp;robot);
  gripControl.addKeyHandlers(&amp;robot);

  <span class="comment">// enable motors and run (if we lose connection to the robot, exit)</span>
  <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;You may now operate the robot with arrow keys or joystick. Operate the gripper with the u, d, o, c, and page up/page down keys.&quot;</span>);
  robot.<a name="a28"></a><a class="code" href="classArRobot.html#aa3657bebab0086dd14ed0c8c3f76dc8b" title="Enables the motors on the robot.">enableMotors</a>();
  robot.<a name="a29"></a><a class="code" href="classArRobot.html#a3c1c3056633caf455c8265259f57f6d7" title="Starts the instance to do processing in this thread.">run</a>(<span class="keyword">true</span>);
  
  <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
  <span class="keywordflow">return</span> 0;
}


</pre></div> </div><!-- contents -->
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Mon Nov 10 2014 07:58:41 for Aria by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
