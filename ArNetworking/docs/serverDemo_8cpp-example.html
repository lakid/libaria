<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ArNetworking: serverDemo.cpp</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ArNetworking
   &#160;<span id="projectnumber">dev20141110</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('serverDemo_8cpp-example.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">serverDemo.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example ArNetworking server providing teleoperation, sonar data, control the camera, etc. This is a basic ArNetworking server. It connects to a robot or simulator, including, if available, IRs, gyro, and bumpers. Give the option "-connectLaser" on the command line to enable the laser rangefinder, if available.</p>
<p>Run "./serverDemo -help" for a full list of command line options.</p>
<p>Once running, connect to this server with a a client such as MobileEyes.</p>
<p>This server provides the following services:</p>
<ul>
<li>User login (optional)</li>
<li>Basic robot telemetry information</li>
<li>Range sensor data values (not used by MobileEyes)</li>
<li>Graphics representing range sensor reading positions</li>
<li>Teleoperation modes (including safe/unsafe drive modes)</li>
<li>Wander mode</li>
<li>Various advanced "custom" commands to control logging, debugging, etc.</li>
<li>If an ACTS or SAV server is running, forward the video stream</li>
<li>Camera control (pan/tilt/zoom) if cameras are available</li>
</ul>
<p>Note that this program requires a terminal to run -- i.e. you can't run it in the background in Linux. To modify it to allow that, remove the key handler code in <a class="el" href="clientCommandLister_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main()</a>.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;Aria.h&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="ArNetworking_8h.html">ArNetworking.h</a>&quot;</span>

<span class="keywordtype">int</span> <a name="a0"></a><a class="code" href="clientCommandLister_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <span class="comment">// mandatory init</span>
  <a name="a1"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#ad99c16b5d947229d9f8e1c5b2d4cdd73">Aria::init</a>();

  <span class="comment">//ArLog::init(ArLog::StdOut, ArLog::Verbose);</span>

  <span class="comment">// set up our parser</span>
  <a name="_a2"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArArgumentParser.html">ArArgumentParser</a> parser(&amp;argc, argv);

  <span class="comment">// load the default arguments </span>
  parser.<a name="a3"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArArgumentParser.html#a501694b62a7f8b0c3cadd84aeafe1b35">loadDefaultArguments</a>();

  <span class="comment">// robot</span>
  <a name="_a4"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html">ArRobot</a> robot;
  <span class="comment">// set up our simple connector</span>
  <a name="_a5"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobotConnector.html">ArRobotConnector</a> robotConnector(&amp;parser, &amp;robot);


  <span class="comment">// add a gyro, it&#39;ll see if it should attach to the robot or not</span>
  <a name="_a6"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArAnalogGyro.html">ArAnalogGyro</a> gyro(&amp;robot);


  <span class="comment">// set up the robot for connecting</span>
  <span class="keywordflow">if</span> (!robotConnector.<a name="a7"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobotConnector.html#ab192ac393d9cc1e5b61b1a82b08d085d">connectRobot</a>())
  {
    printf(<span class="stringliteral">&quot;Could not connect to robot... exiting\n&quot;</span>);
    <a name="a8"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#a6abc3d39b3e9548063bb8e78375acc17">Aria::exit</a>(1);
  }

  <a name="_a9"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArDataLogger.html">ArDataLogger</a> dataLogger(&amp;robot, <span class="stringliteral">&quot;dataLog.txt&quot;</span>);
  dataLogger.<a name="a10"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArDataLogger.html#a28f4fc3cf8955e837378502de3707fda">addToConfig</a>(<a name="a11"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#ace50b4190f04bcacaf285bb5830c5fc2">Aria::getConfig</a>());
  
  <span class="comment">// our base server object</span>
  <a name="_a12"></a><a class="code" href="classArServerBase.html" title="Base server for all networking services.">ArServerBase</a> server;

  <a name="_a13"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLaserConnector.html">ArLaserConnector</a> laserConnector(&amp;parser, &amp;robot, &amp;robotConnector);
  <a name="_a14"></a><a class="code" href="classArServerSimpleOpener.html" title="Set up and open an ArNetworking server.">ArServerSimpleOpener</a> simpleOpener(&amp;parser);


  <a name="_a15"></a><a class="code" href="classArClientSwitchManager.html" title="The serverInfoFile takes the form of a config file roughly, there are 3 things you can put in it now...">ArClientSwitchManager</a> clientSwitchManager(&amp;server, &amp;parser);

  <span class="comment">// parse the command line... fail and print the help if the parsing fails</span>
  <span class="comment">// or if the help was requested</span>
  <span class="keywordflow">if</span> (!<a name="a16"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#a1b090c01d88bb420b8cf8e0384d25ee1">Aria::parseArgs</a>() || !parser.<a name="a17"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArArgumentParser.html#ac3889cbdfa862031c51bf80e06954914">checkHelpAndWarnUnparsed</a>())
  {    
    <a name="a18"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#a10d71f3d4d0cf7f38c58a1f749f64a42">Aria::logOptions</a>();
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#a6abc3d39b3e9548063bb8e78375acc17">Aria::exit</a>(1);
  }

  <span class="comment">// Set up where we&#39;ll look for files such as user/password </span>
  <span class="keywordtype">char</span> fileDir[1024];
  <a name="a19"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArUtil.html#a196eae227f3e6fc7387bb623b4ddea03">ArUtil::addDirectories</a>(fileDir, <span class="keyword">sizeof</span>(fileDir), <a name="a20"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#a9cbf9a172cb85275b05d391685f223e0">Aria::getDirectory</a>(), 
                         <span class="stringliteral">&quot;ArNetworking/examples&quot;</span>);

  <span class="comment">// first open the server up</span>
  <span class="keywordflow">if</span> (!simpleOpener.<a name="a21"></a><a class="code" href="classArServerSimpleOpener.html#a6429c1069dee5edc19fb7dc94078bed0" title="Function to open up the server.">open</a>(&amp;server, fileDir, 240))
  {
    <span class="keywordflow">if</span> (simpleOpener.<a name="a22"></a><a class="code" href="classArServerSimpleOpener.html#a7416e273f937d9301eb94ed02e04825d" title="Returns true if the open failed because of a bad user file.">wasUserFileBad</a>())
      printf(<span class="stringliteral">&quot;Bad user/password/permissions file\n&quot;</span>);
    <span class="keywordflow">else</span>
      printf(<span class="stringliteral">&quot;Could not open server port\n&quot;</span>);
    exit(1);
  }

  <span class="comment">// Range devices:</span>
 
 
  <a name="_a23"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArSonarDevice.html">ArSonarDevice</a> sonarDev;
  robot.<a name="a24"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a97d57b28549fdef851c00749a97cc776">addRangeDevice</a>(&amp;sonarDev);

  <a name="_a25"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArIRs.html">ArIRs</a> irs;
  robot.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a97d57b28549fdef851c00749a97cc776">addRangeDevice</a>(&amp;irs);

  <a name="_a26"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArBumpers.html">ArBumpers</a> bumpers;
  robot.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a97d57b28549fdef851c00749a97cc776">addRangeDevice</a>(&amp;bumpers);

  <span class="comment">// attach services to the server</span>
  <a name="_a27"></a><a class="code" href="classArServerInfoRobot.html" title="Server component providing basic robot status information to clients.">ArServerInfoRobot</a> serverInfoRobot(&amp;server, &amp;robot);
  <a name="_a28"></a><a class="code" href="classArServerInfoSensor.html" title="Service providing clients with data from range sensors.">ArServerInfoSensor</a> serverInfoSensor(&amp;server, &amp;robot);
  <a name="_a29"></a><a class="code" href="classArServerInfoDrawings.html" title="Service to provide clients with information about graphical figures to be displayed with the map...">ArServerInfoDrawings</a> drawings(&amp;server);

  <span class="comment">// modes for controlling robot movement</span>
  <a name="_a30"></a><a class="code" href="classArServerModeStop.html">ArServerModeStop</a> modeStop(&amp;server, &amp;robot);
  <a name="_a31"></a><a class="code" href="classArServerModeRatioDrive.html">ArServerModeRatioDrive</a> modeRatioDrive(&amp;server, &amp;robot);  
  <a name="_a32"></a><a class="code" href="classArServerModeWander.html">ArServerModeWander</a> modeWander(&amp;server, &amp;robot);
  modeStop.<a name="a33"></a><a class="code" href="classArServerMode.html#ac071f8179603fecc38d69f8e89e88f34" title="Sets this mode to default (so if a mode deactivates it activates this)">addAsDefaultMode</a>();
  modeStop.<a name="a34"></a><a class="code" href="classArServerModeStop.html#a701b1ae94cfda807e9f3d6c51a9fc53f" title="The function called when the mode is activated.">activate</a>();

  <span class="comment">// set up the simple commands</span>
  <a name="_a35"></a><a class="code" href="classArServerHandlerCommands.html" title="Class for having commands that can be called easily on the client.">ArServerHandlerCommands</a> commands(&amp;server);
  <a name="_a36"></a><a class="code" href="classArServerSimpleComUC.html" title="Class for sending commands to the microcontroller (uC)">ArServerSimpleComUC</a> uCCommands(&amp;commands, &amp;robot);  <span class="comment">// send commands directly to microcontroller</span>
  <a name="_a37"></a><a class="code" href="classArServerSimpleComMovementLogging.html" title="Class for enabling or disabling logging of movement commands and data.">ArServerSimpleComMovementLogging</a> loggingCommands(&amp;commands, &amp;robot); <span class="comment">// control debug logging</span>
  <a name="_a38"></a><a class="code" href="classArServerSimpleComGyro.html" title="Class for enabling or disabling the gyro.">ArServerSimpleComGyro</a> gyroCommands(&amp;commands, &amp;robot, &amp;gyro); <span class="comment">// configure gyro</span>
  <a name="_a39"></a><a class="code" href="classArServerSimpleComLogRobotConfig.html" title="Request configuration from robot controller and log the result.">ArServerSimpleComLogRobotConfig</a> configCommands(&amp;commands, &amp;robot); <span class="comment">// control more debug logging</span>
  <a name="_a40"></a><a class="code" href="classArServerSimpleServerCommands.html">ArServerSimpleServerCommands</a> serverCommands(&amp;commands, &amp;server); <span class="comment">// control ArNetworking debug logging</span>
  <a name="_a41"></a><a class="code" href="classArServerSimpleLogRobotDebugPackets.html" title="Class that logs a special debug packet from the robot.">ArServerSimpleLogRobotDebugPackets</a> logRobotDebugPackets(&amp;commands, &amp;robot, <span class="stringliteral">&quot;.&quot;</span>);  <span class="comment">// debugging tool</span>

  <span class="comment">// ArServerModeDrive is an older drive mode. ArServerModeRatioDrive is newer and generally performs better,</span>
  <span class="comment">// but you can use this for old clients if neccesary.</span>
  <span class="comment">//ArServerModeDrive modeDrive(&amp;server, &amp;robot);</span>
  <span class="comment">//modeDrive.addControlCommands(&amp;commands); // configure the drive modes (e.g. enable/disable safe drive)</span>

  <a name="_a42"></a><a class="code" href="classArServerHandlerConfig.html" title="Class for sending and receiving ArConfig data via ArNetworking.">ArServerHandlerConfig</a> serverHandlerConfig(&amp;server, <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#ace50b4190f04bcacaf285bb5830c5fc2">Aria::getConfig</a>()); <span class="comment">// make a config handler</span>
  <a name="a43"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#a830b6edab2079ae1ffeb7e164e30636b">ArLog::addToConfig</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#ace50b4190f04bcacaf285bb5830c5fc2">Aria::getConfig</a>()); <span class="comment">// let people configure logging</span>

  modeRatioDrive.<a name="a44"></a><a class="code" href="classArServerModeRatioDrive.html#a5f9789a3e51ca3f52d3efbd7be5d4c66" title="Adds to a config in a section.">addToConfig</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#ace50b4190f04bcacaf285bb5830c5fc2">Aria::getConfig</a>(), <span class="stringliteral">&quot;Teleop settings&quot;</span>); <span class="comment">// able to configure teleop settings</span>
  modeRatioDrive.<a name="a45"></a><a class="code" href="classArServerModeRatioDrive.html#a4f2e0b9b1cbdca73db31d95437e095b2" title="This adds commands that&#39;ll let you disable and enable safe driving.">addControlCommands</a>(&amp;commands);

  <span class="comment">// Forward video if either ACTS or SAV server are running.</span>
  <span class="comment">// You can find out more about SAV and ACTS on our website</span>
  <span class="comment">// http://robots.activmedia.com. ACTS is for color tracking and is</span>
  <span class="comment">// a separate product. SAV just does software A/V transmitting and is</span>
  <span class="comment">// free to all our customers. Just run ACTS or SAV server before you</span>
  <span class="comment">// start this program and this class here will forward video from the</span>
  <span class="comment">// server to the client.</span>
  <a name="_a46"></a><a class="code" href="classArHybridForwarderVideo.html" title="This class takes video another source and serves it back up.">ArHybridForwarderVideo</a> videoForwarder(&amp;server, <span class="stringliteral">&quot;localhost&quot;</span>, 7070);
  
  <span class="comment">// Control a pan/tilt/zoom camera, if one is installed, and the video</span>
  <span class="comment">// forwarder was enabled above.</span>
  <a name="_a47"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArPTZ.html">ArPTZ</a> *camera = NULL;
  <a name="_a48"></a><a class="code" href="classArServerHandlerCamera.html" title="Accepts and processes camera pan/tilt/zoom requests from the client, and provides information about t...">ArServerHandlerCamera</a> *handlerCamera = NULL;
  <a name="_a49"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArCameraCollection.html">ArCameraCollection</a> *cameraCollection = NULL;
  <span class="keywordflow">if</span> (videoForwarder.<a name="a50"></a><a class="code" href="classArHybridForwarderVideo.html#af576fd70231e335e66a6a3b0e9f1fbea" title="Returns if we&#39;re forwarding video or not.">isForwardingVideo</a>())
  {
    <span class="keywordtype">bool</span> invertedCamera = <span class="keyword">false</span>;
    camera = <span class="keyword">new</span> <a name="_a51"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArVCC4.html">ArVCC4</a>(&amp;robot, invertedCamera, 
                        ArVCC4::COMM_UNKNOWN, <span class="keyword">true</span>, <span class="keyword">true</span>);
    camera-&gt;<a name="a52"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArPTZ.html#adc51dbc6919fc6cde0e04985246c6a61">init</a>();

    cameraCollection = <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArCameraCollection.html">ArCameraCollection</a>();
    cameraCollection-&gt;<a name="a53"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArCameraCollection.html#a4298508408621d2db978f1408a8dc27e">addCamera</a>(<span class="stringliteral">&quot;Cam1&quot;</span>, <span class="stringliteral">&quot;VCC4&quot;</span>, <span class="stringliteral">&quot;Camera&quot;</span>, <span class="stringliteral">&quot;VCC4&quot;</span>);
    handlerCamera = <span class="keyword">new</span> <a class="code" href="classArServerHandlerCamera.html" title="Accepts and processes camera pan/tilt/zoom requests from the client, and provides information about t...">ArServerHandlerCamera</a>(<span class="stringliteral">&quot;Cam1&quot;</span>, 
                                              &amp;server, 
                                              &amp;robot,
                                              camera, 
                                              cameraCollection);
  }

  <span class="comment">// You can use this class to send a set of arbitrary strings </span>
  <span class="comment">// for MobileEyes to display, this is just a small example</span>
  <a name="_a54"></a><a class="code" href="classArServerInfoStrings.html" title="This will set up strings to send to MobileEyes so that server developers can easily add more informat...">ArServerInfoStrings</a> stringInfo(&amp;server);
  <a name="a55"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#af1d44610d83bc5112040bc7d4c602ba9">Aria::getInfoGroup</a>()-&gt;<a name="a56"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArStringInfoGroup.html#a1e1784e772af0d6318ade1fe309f11db">addAddStringCallback</a>(stringInfo.<a name="a57"></a><a class="code" href="classArServerInfoStrings.html#a2c5ebea58bca4a8ad16ce5368e6f668c" title="Gets the functor for adding a string (for ArStringInfoGroup)">getAddStringFunctor</a>());
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#af1d44610d83bc5112040bc7d4c602ba9">Aria::getInfoGroup</a>()-&gt;<a name="a58"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArStringInfoGroup.html#aa1315a75e4e69ba232b4239f61b5a2e4">addStringInt</a>(
          <span class="stringliteral">&quot;Motor Packet Count&quot;</span>, 10, 
          <span class="keyword">new</span> <a name="_a59"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArConstRetFunctorC.html">ArConstRetFunctorC&lt;int, ArRobot&gt;</a>(&amp;robot, 
                                               &amp;<a name="a60"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a9eb53fc27147cd3467fa3254cbb829f0">ArRobot::getMotorPacCount</a>));
  <span class="comment">/*</span>
<span class="comment">  Aria::getInfoGroup()-&gt;addStringInt(</span>
<span class="comment">          &quot;Laser Packet Count&quot;, 10, </span>
<span class="comment">          new ArRetFunctorC&lt;int, ArSick&gt;(&amp;sick, </span>
<span class="comment">                                         &amp;ArSick::getSickPacCount));</span>
<span class="comment">  */</span>
  
  <span class="comment">// start the robot running, true means that if we lose connection the run thread stops</span>
  robot.<a name="a61"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a3c3d878cfd11a2ef91230005a83bfcaa">runAsync</a>(<span class="keyword">true</span>);


  <span class="comment">// connect the laser(s) if it was requested</span>
  <span class="keywordflow">if</span> (!laserConnector.<a name="a62"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLaserConnector.html#ab97ce6a5fedebf44526773bc674b970e">connectLasers</a>())
  {
    printf(<span class="stringliteral">&quot;Could not connect to lasers... exiting\n&quot;</span>);
    <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#a6abc3d39b3e9548063bb8e78375acc17">Aria::exit</a>(2);
  }
  

  drawings.<a name="a63"></a><a class="code" href="classArServerInfoDrawings.html#afce43fb3fd0324b092600c9eb6fb50a7" title="Adds all of the robot&#39;s range devices (using their default shape)">addRobotsRangeDevices</a>(&amp;robot);

  <span class="comment">// log whatever we wanted to before the runAsync</span>
  simpleOpener.<a name="a64"></a><a class="code" href="classArServerSimpleOpener.html#ad05fedc301ab89072e61879999463d17" title="Logs the things requested for logging, may check things later.">checkAndLog</a>();
  <span class="comment">// now let it spin off in its own thread</span>
  server.<a name="a65"></a><a class="code" href="classArServerBase.html#a93c742ddc58a8f035a0d1b9c1fae4599" title="Runs the server in its own thread.">runAsync</a>();

  printf(<span class="stringliteral">&quot;Server is now running...\n&quot;</span>);

  <span class="comment">// Add a key handler so that you can exit by pressing</span>
  <span class="comment">// escape. Note that a key handler prevents you from running</span>
  <span class="comment">// a program in the background on Linux, since it expects an </span>
  <span class="comment">// active terminal to read keys from; remove this if you want</span>
  <span class="comment">// to run it in the background.</span>
  <a name="_a66"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArKeyHandler.html">ArKeyHandler</a> *keyHandler;
  <span class="keywordflow">if</span> ((keyHandler = <a name="a67"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#a5b8042b38b19d6a5d3cfbed4df483e67">Aria::getKeyHandler</a>()) == NULL)
  {
    keyHandler = <span class="keyword">new</span> <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArKeyHandler.html">ArKeyHandler</a>;
    <a name="a68"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#a9e5496a4ec2c379c8e18706922b57cc1">Aria::setKeyHandler</a>(keyHandler);
    robot.<a name="a69"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a5aecc7ac998c9a31b82fdb904efa8609">lock</a>();
    robot.<a name="a70"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#ab4ea516667d2358f35b435d97b616ab1">attachKeyHandler</a>(keyHandler);
    robot.<a name="a71"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a403d9de010dc2b8d478cd0b14b2d9491">unlock</a>();
    printf(<span class="stringliteral">&quot;To exit, press escape.\n&quot;</span>);
  }

  <span class="comment">// Read in parameter files.</span>
  std::string configFile = <span class="stringliteral">&quot;serverDemoConfig.txt&quot;</span>;
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#ace50b4190f04bcacaf285bb5830c5fc2">Aria::getConfig</a>()-&gt;<a name="a72"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArConfig.html#a5f9d30c8911050b8d510837d27f3e067">setBaseDirectory</a>(<span class="stringliteral">&quot;./&quot;</span>);
  <span class="keywordflow">if</span> (<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#ace50b4190f04bcacaf285bb5830c5fc2">Aria::getConfig</a>()-&gt;parseFile(configFile.c_str(), <span class="keyword">true</span>, <span class="keyword">true</span>))
  {
    <a name="a73"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#a43a8b3789126c818f390f24bdbceccce">ArLog::log</a>(<a name="a74"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1">ArLog::Normal</a>, <span class="stringliteral">&quot;Loaded config file %s&quot;</span>, configFile.c_str());
  }
  <span class="keywordflow">else</span>
  {
    <span class="keywordflow">if</span> (<a name="a75"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArUtil.html#a731729868fac7cf87c9894fe024f8a6c">ArUtil::findFile</a>(configFile.c_str()))
    {
      <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#a43a8b3789126c818f390f24bdbceccce">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1">ArLog::Normal</a>, 
                 <span class="stringliteral">&quot;Trouble loading configuration file %s, continuing&quot;</span>,
                 configFile.c_str());
    }
    <span class="keywordflow">else</span>
    {
      <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#a43a8b3789126c818f390f24bdbceccce">ArLog::log</a>(<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1">ArLog::Normal</a>, 
                 <span class="stringliteral">&quot;No configuration file %s, will try to create if config used&quot;</span>,
                 configFile.c_str());
    }
  }

  clientSwitchManager.<a name="a76"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArASyncTask.html#a3d9b25fe57d5d4c4a7146827798dcbe0">runAsync</a>();

  robot.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a5aecc7ac998c9a31b82fdb904efa8609">lock</a>();
  robot.<a name="a77"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#aa3657bebab0086dd14ed0c8c3f76dc8b">enableMotors</a>();
  robot.<a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a403d9de010dc2b8d478cd0b14b2d9491">unlock</a>();

  robot.<a name="a78"></a><a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classArRobot.html#a95201be7c39b521983b51e6f5d9303e4">waitForRunExit</a>();
  <a class="codeRef" doxygen="Aria.tag:../../docs/" href="../../docs/classAria.html#a6abc3d39b3e9548063bb8e78375acc17">Aria::exit</a>(0);
}


</pre></div> </div><!-- contents -->
</div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Mon Nov 10 2014 07:58:35 for ArNetworking by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
